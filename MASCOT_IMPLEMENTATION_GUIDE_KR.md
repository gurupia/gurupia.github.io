# ðŸ“˜ ë§ˆìŠ¤ì½”íŠ¸ ì‹œìŠ¤í…œ ê¸°ìˆ  ì°¸ì¡° ë§¤ë‰´ì–¼

## 1. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

ë§ˆìŠ¤ì½”íŠ¸ ì‹œìŠ¤í…œì€ ì™¸ë¶€ í”„ë ˆìž„ì›Œí¬ ì˜ì¡´ì„± ì—†ì´ DOM ìƒì—ì„œ ìž‘ë™í•˜ëŠ” ë…ë¦½í˜• JavaScript ëª¨ë“ˆ(`mascot.js`)ìž…ë‹ˆë‹¤. ì¤‘ì•™ ì—…ë°ì´íŠ¸ ë£¨í”„ë¥¼ ê°€ì§„ ê°ì²´ ì§€í–¥ ë””ìžì¸ íŒ¨í„´ì„ ë”°ë¦…ë‹ˆë‹¤.

### í•µì‹¬ í´ëž˜ìŠ¤ (Core Classes)

| í´ëž˜ìŠ¤ | ì„¤ëª… | ì£¼ìš” ì—­í•  |
|-------|-------------|----------------------|
| **`Mascot`** | ë©”ì¸ ì—”í‹°í‹° | ì´ë™, AI ìƒíƒœ, ì• ë‹ˆë©”ì´ì…˜, ì¶©ëŒ, ë Œë”ë§. |
| **`Projectile`** | ë§ˆìŠ¤ì½”íŠ¸ê°€ ë°œì‚¬í•˜ëŠ” ë¬´ê¸° | ê¶¤ì  ê³„ì‚°, íƒ€ê²© ê°ì§€, ìˆ˜ëª… ê´€ë¦¬. |
| **`Particle`** | ì‹œê° íš¨ê³¼(FX) ìš”ì†Œ | ë¬¼ë¦¬ ê¸°ë°˜ ì›€ì§ìž„, íŽ˜ì´ë”©(Fading), DOM ì •ë¦¬. |
| **`SoundManager`** | ì˜¤ë””ì˜¤ ì—”ì§„ | Web Audio API ê´€ë¦¬, ì‹¤ì‹œê°„ í•©ì„±, ìŠ¤í…Œë ˆì˜¤ íŒ¨ë‹. |

---

## 2. ì»´í¬ë„ŒíŠ¸ ìƒì„¸

### 2.1 ë§ˆìŠ¤ì½”íŠ¸ ì—”í‹°í‹° (`class Mascot`)
ê° ë§ˆìŠ¤ì½”íŠ¸ëŠ” ê³ ìœ í•œ ìƒíƒœì™€ ì†ì„±ì„ ê°€ì§„ ë…ë¦½ì ì¸ ì¸ìŠ¤í„´ìŠ¤ìž…ë‹ˆë‹¤.

#### **ì†ì„± (Properties)**
- `id`: ê³ ìœ  ì‹ë³„ìž (ë¬¸ìžì—´).
- `x, y`: í˜„ìž¬ ì¢Œí‘œ (ì¢Œìƒë‹¨ ê¸°ì¤€).
- `vx, vy`: ì†ë„ ë²¡í„°.
- `aiType`: í–‰ë™ ì„±ê²© (`neutral`, `curious`, `shy`, `aggressive`).
- `weaponType`: í˜„ìž¬ ìž¥ì°©ëœ ë¬´ê¸° (`machinegun`, `shotgun`, ë“±).

#### **í–‰ë™ AI (State Machine)**
AI ë¡œì§ì€ `updatePosition()` ë‚´ì—ì„œ ì‹¤í–‰ë˜ë©° `aiType`ì— ë”°ë¼ ê¸°ë³¸ ì´ë™ì„ ìž¬ì •ì˜í•©ë‹ˆë‹¤.
- **Neutral (ì¤‘ë¦½)**: ë²½ íŠ•ê¸°ê¸°ë¥¼ í¬í•¨í•œ ë¬´ìž‘ìœ„ ë°°íšŒ.
- **Curious (í˜¸ê¸°ì‹¬)**: ì»¤ì„œì™€ì˜ ê±°ë¦¬ê°€ > 50px & < 400px ì¼ ë•Œ ì»¤ì„œ ë°©í–¥ìœ¼ë¡œ ë²¡í„° ê³„ì‚°.
- **Shy (ìˆ˜ì¤ìŒ)**: ì»¤ì„œì™€ì˜ ê±°ë¦¬ê°€ < 200px ì¼ ë•Œ ì»¤ì„œ *ë°˜ëŒ€* ë°©í–¥ìœ¼ë¡œ ë²¡í„° ê³„ì‚°.
- **Aggressive (ê³µê²©ì )**: ì»¤ì„œì™€ì˜ ê±°ë¦¬ê°€ < 500px ì¼ ë•Œ ì»¤ì„œ ë°©í–¥ìœ¼ë¡œ ê³ ì† ë²¡í„° ê³„ì‚°.

### 2.2 ì‹œê° íš¨ê³¼ ì‹œìŠ¤í…œ

#### **íŒŒí‹°í´ ì—”ì§„ (`class Particle`)**
- Canvas ì»¨í…ìŠ¤íŠ¸ ì „í™˜ ì˜¤ë²„í—¤ë“œë¥¼ í”¼í•˜ê¸° ìœ„í•´ DOM ìš”ì†Œ(`div.fx-particle`)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **ë¬¼ë¦¬ (Physics)**: ë§¤ í”„ë ˆìž„ë§ˆë‹¤ ì¤‘ë ¥(`vy += 0.1`)ê³¼ ë§ˆì°°ë ¥(`decay`)ì„ ì ìš©í•©ë‹ˆë‹¤.
- **ìˆ˜ëª…ì£¼ê¸° (Lifecycle)**: `life <= 0`ì´ ë˜ë©´ ìžë™ìœ¼ë¡œ ìš”ì†Œë¥¼ ì œê±°í•©ë‹ˆë‹¤.

#### **í™”ë©´ í”ë“¤ë¦¼ (Screen Shake)**
- CSS ì• ë‹ˆë©”ì´ì…˜: `@keyframes screen-shake`
- `Projectile.explode()`ê°€ `createExplosionFX()`ë¥¼ í˜¸ì¶œí•  ë•Œ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤.
- êµ¬í˜„: `document.body`ì— `.shake` í´ëž˜ìŠ¤ë¥¼ 300ms ë™ì•ˆ ì¶”ê°€í•©ë‹ˆë‹¤.

### 2.3 ê³µê°„ ì˜¤ë””ì˜¤ (`class SoundManager`)
- **ê¸°ìˆ **: Web Audio API (ì™¸ë¶€ ì—ì…‹ ë¶ˆí•„ìš”).
- **PannerNode**: í™”ë©´ ìœ„ì¹˜ì— ë”°ë¥¸ ì‹¤ì‹œê°„ ìŠ¤í…Œë ˆì˜¤ íŒ¨ë‹.
  - `pan.value = (x / window.innerWidth) * 2 - 1` (-1 ì™¼ìª½ ~ +1 ì˜¤ë¥¸ìª½).
- **í•©ì„± (Synthesis)**:
  - `Bullet`: ì§€ìˆ˜ì  ì£¼íŒŒìˆ˜ ëž¨í”„ë¥¼ ê°€ì§„ ì‚¬ê°íŒŒ (ë ˆì´ì € ëŠë‚Œ).
  - `Flame`: ë…¸ì´ì¦ˆ íŠ¹ì„±ì„ ê°€ì§„ í†±ë‹ˆíŒŒ.
  - `Explosion`: ê¸‰ê²©í•œ ì£¼íŒŒìˆ˜ í•˜ê°•ì„ ê°€ì§„ ì‚¼ê°íŒŒ.

---

## 3. ë°ì´í„° ì˜ì†ì„± (`localStorage`)

ì„¤ì •ì€ `mascots-data` í‚¤ì— ë³€ê²½ ì‚¬í•­ì´ ìžˆì„ ë•Œë§ˆë‹¤ ìžë™ìœ¼ë¡œ ì €ìž¥ë©ë‹ˆë‹¤.

**ìŠ¤í‚¤ë§ˆ êµ¬ì¡°**:
```json
[
  {
    "id": "mascot_17145892012",
    "image": "data:image/png;base64...",
    "isCustom": true,
    "size": 64,
    "x": 100, "y": 200, "vx": 1.5, "vy": -0.5,
    "disabled": false,
    "noFloat": false,
    "effect3d": true,
    "actionMode": true,
    "weaponType": "shotgun",
    "aiType": "aggressive"
  }
]
```

---

## 4. ì„¤ì • ìƒìˆ˜

ì‹œìŠ¤í…œ ì œí•œ ë° ë¬¼ë¦¬ ë§¤ê°œë³€ìˆ˜ëŠ” `mascot.js` ìƒë‹¨ì— ì •ì˜ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.

```javascript
const MAX_PROJECTILES = 100;     // DOM ì§€ì—° ë°©ì§€ë¥¼ ìœ„í•œ ìµœëŒ€ í™œì„± íƒ„í™˜ ìˆ˜
const MAX_PARTICLES = 50;        // ìµœëŒ€ ì‹œê° íš¨ê³¼ íŒŒí‹°í´ ìˆ˜
const collisionSettings = { 
    enabled: true, 
    strength: 0.8                // íƒ„ì„± ê³„ìˆ˜ (0.0 - 1.0)
};
const fxSettings = {             // ì „ì—­ í† ê¸€
    screenShake: true,
    particles: true,
    sound: true
};
```

---

## 5. ì „ì—­ ì´ë²¤íŠ¸ ë£¨í”„

`globalUpdate()` í•¨ìˆ˜ëŠ” `requestAnimationFrame`ì„ ì‚¬ìš©í•˜ì—¬ ì „ì²´ ì‹œìŠ¤í…œì„ êµ¬ë™í•©ë‹ˆë‹¤.

1. **ë°œì‚¬ì²´ ì—…ë°ì´íŠ¸**: íƒ„í™˜ ì´ë™, ì¶©ëŒ í™•ì¸, ì†Œë©¸ëœ íƒ„í™˜ ì œê±°.
2. **íŒŒí‹°í´ ì—…ë°ì´íŠ¸**: ë¬¼ë¦¬ ì ìš©, íŽ˜ì´ë“œ ì•„ì›ƒ, ì†Œë©¸ëœ íŒŒí‹°í´ ì œê±°.
3. **ë§ˆìŠ¤ì½”íŠ¸ ì—…ë°ì´íŠ¸**: ì†ë„ ì ìš©, AI ë¡œì§ ì‹¤í–‰, ë²½ ì¶©ëŒ ì²˜ë¦¬.
4. **ì¶©ëŒ ì²´í¬**: ë¬¼ë¦¬ ìƒí˜¸ìž‘ìš©ì„ ìœ„í•œ ëª¨ë“  ë§ˆìŠ¤ì½”íŠ¸ ê°„ì˜ O(N^2) ê²€ì‚¬.
5. **ë£¨í”„**: ë‹¤ìŒ í”„ë ˆìž„ ìš”ì²­.

---

## 6. ë§ˆìŠ¤ì½”íŠ¸ ì• ë‹ˆë©”ì´í„° (WebP Generator)

`mascot-animator`ëŠ” ì •ì  ì´ë¯¸ì§€ë¥¼ ì›€ì§ì´ëŠ” WebP/GIFë¡œ ë³€í™˜í•˜ëŠ” ë…ë¦½í˜• ë„êµ¬ìž…ë‹ˆë‹¤.

### 6.1 ì£¼ìš” ê¸°ëŠ¥
- **ì†ŒìŠ¤ ì§€ì›**: ì´ë¯¸ì§€(PNG, JPG) ë° ë¹„ë””ì˜¤(MP4, WebM) íŒŒì¼/URL.
- **ì ˆì°¨ì  ì• ë‹ˆë©”ì´ì…˜**: Breathing, Floating, Jump, Shake, Squash, Spin ë“±.
- **ë‚´ë³´ë‚´ê¸° í¬ë§·**:
  - `Animated WebP`: íˆ¬ëª… ë°°ê²½ ì§€ì›, ê³ ì••ì¶•.
  - `GIF`: íˆ¬ëª… ë°°ê²½ ì§€ì›, íŒ”ë ˆíŠ¸ ìµœì í™”.
  - `WebM`: íˆ¬ëª… ë¹„ë””ì˜¤ (VP9 ì½”ë±).

### 6.2 íˆ¬ëª…ë„ ë³´ìž¥ ê¸°ìˆ  (Frame-by-Frame Rendering)
ë¸Œë¼ìš°ì €ì˜ `MediaRecorder` APIëŠ” ì‹¤ì‹œê°„ ì••ì¶• ì‹œ ì•ŒíŒŒ ì±„ë„(íˆ¬ëª…ë„)ì„ ì¢…ì¢… ìœ ì‹¤í•˜ê±°ë‚˜ ê²€ì€ ë°°ê²½ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ë¬¸ì œê°€ ìžˆìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **í”„ë ˆìž„ ë‹¨ìœ„ ë Œë”ë§** ë°©ì‹ì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤.

1. **ìº¡ì²˜ (Capture)**: ìº”ë²„ìŠ¤ì˜ ë§¤ í”„ë ˆìž„ì„ ë¬´ì†ì‹¤ PNG Blobìœ¼ë¡œ ì¶”ì¶œ (`canvas.toBlob`).
2. **ì €ìž¥ (Buffer)**: ì¶”ì¶œëœ ì´ë¯¸ì§€ë“¤ì„ `ffmpeg.wasm`ì˜ ê°€ìƒ íŒŒì¼ ì‹œìŠ¤í…œ(MEMFS)ì— ìˆœì°¨ ì €ìž¥ (`frame_001.png`, ...).
3. **ì¸ì½”ë”© (Encoding)**: FFmpegë¥¼ ì‚¬ìš©í•˜ì—¬ PNG ì‹œí€€ìŠ¤ë¥¼ ìµœì¢… í¬ë§·(WebP/GIF)ìœ¼ë¡œ ë³€í™˜.
   - **WebP**: `libwebp` ì½”ë±, `-lossless 1`, `-vcodec rgba` ì‚¬ìš©.
   - **GIF**: `palettegen` ë° `paletteuse` í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³ í’ˆì§ˆ íˆ¬ëª…ë„ í™•ë³´.

### 6.3 ë³´ì•ˆ ìš”êµ¬ì‚¬í•­ (Security Requirements)
`ffmpeg.wasm`ì€ ê³ ì„±ëŠ¥ ì²˜ë¦¬ë¥¼ ìœ„í•´ `SharedArrayBuffer`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…ìƒ ì´ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë‹¤ìŒ HTTP í—¤ë”ê°€ í•„ìˆ˜ìž…ë‹ˆë‹¤.

- `Cross-Origin-Opener-Policy: same-origin`
- `Cross-Origin-Embedder-Policy: require-corp`

**í•´ê²°ì±…**:
`file://` í”„ë¡œí† ì½œì—ì„œëŠ” ìž‘ë™í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, í¬í•¨ëœ `server.py`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œì»¬ ì„œë²„ë¥¼ êµ¬ë™í•´ì•¼ í•©ë‹ˆë‹¤.
```bash
python server.py
# http://localhost:8080 ì—ì„œ í—¤ë”ì™€ í•¨ê»˜ ì„œë¹™ë¨
```
